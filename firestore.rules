rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // 使用者及其子集合資料
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    
      // 帳戶資料（共用）
      match /accounts/{accountId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // 個人與商業收支紀錄
      match /records/{recordId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // 分類設定
      match /categories/{categoryId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

    // 轉帳紀錄（個人）
    match /transfer-records/{userId}/records/{recordId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 限額設定（個人）
    match /limits/{userId}/items/{itemId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 商業收支紀錄
    match /business-records/{userId}/items/{recordId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 續費提醒（共用）
    match /reminders/{userId}/items/{reminderId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 拒絕所有未明確允許的存取
    match /{document=**} {
      allow read, write: if false;
    }
  }
}